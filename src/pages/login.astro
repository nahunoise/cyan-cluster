---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Acceso | The Creation Society">
  <main class="max-w-md mx-auto pt-32 px-6 text-center">
    <h1 class="text-4xl font-serif text-creation-gold mb-4">Acceso Creadores</h1>
    <p class="text-creation-cream/60 text-sm mb-10">Solo para miembros invitados.</p>
    
    <form id="login-form" class="space-y-4 text-left">
      <div>
        <label class="text-xs uppercase tracking-widest text-creation-gold">Correo Electrónico</label>
        <input 
          type="email" 
          id="email"
          required
          class="w-full bg-white/5 border border-creation-gold/20 p-4 rounded-xl text-creation-cream mt-2 focus:border-creation-gold outline-none transition-all"
          placeholder="nombre@email.com"
        />
      </div>
      <button 
        type="submit" 
        class="w-full bg-creation-gold text-creation-dark py-4 rounded-xl font-bold hover:brightness-110 transition-all"
      >
        Enviar enlace de acceso
      </button>
      <div id="message" class="text-sm text-center pt-4 italic text-creation-cream/40"></div>
    </form>
  </main>
</Layout>

<script>
  import { supabase } from '../lib/supabase';

  const form = document.getElementById('login-form');
  const messageDiv = document.getElementById('message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const emailInput = document.getElementById('email') as HTMLInputElement;
    const email = emailInput.value;

    const { error } = await supabase.auth.signInWithOtp({
      email,
      options: {
        // IMPORTANTE: window.location.origin detectará si es localhost o tu web real
        emailRedirectTo: `${window.location.origin}/dashboard`, 
      },
    });

    if (error) {
      console.error(error);
      messageDiv!.textContent = "Error: Verifica que el correo haya sido invitado.";
    } else {
      messageDiv!.textContent = "¡Revisa tu correo! Te enviamos un enlace de acceso.";
    }
  });
</script>